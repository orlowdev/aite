{% extends 'base_posts.html' %}

{% load crispy_forms_tags %}
{% load staticfiles %}

{% block title %}{{ post.title }}{% endblock %}

{% block post_detail_link %}
    {% comment %}TODO: Add post breadcrumb link{% endcomment %}
    <li><a href="{{ comment.get_absolute_url }}">{{ comment.created_at }}</a></li>
{% endblock %}

{% block main %}

    {{ comment }}
    <div class="container">
        <p>{{ comment.content }}</p>
        <footer>
            via {{ comment.user }} | <cite title="">{{ comment.created_at|timesince }} ago</cite>
            {% if comment.children.count > 0 %}
                | {{ comment.children|length }}
                | {{ comment.children|length|pluralize:"comment,comments" }}
            {% endif %}

            {% if request.user == comment.user %}
                | <a href="{{ comment.get_delete_url }}">Delete</a>
            {% endif %}
        </footer>
        <hr/>

        <div>
            {% for reply in comment.children %}
                <blockquote>
                    <p>{{ reply.content }}</p>
                    <footer>
                        via {{ reply.user }} | <cite title="">{{ reply.created_at|timesince }} ago</cite>
                        {% if request.user == comment.user %}
                            | <a href="{{ child_comment.get_delete_url }}">Delete</a>
                        {% endif %}
                    </footer>
                </blockquote>
            {% endfor %}
            {% if request.user.is_authenticated %}
                <form method="POST" action=".">{% csrf_token %}
                    {{ form|crispy }}
                    <input type="hidden" name="parent_id" value="{{ comment.id }}">
                    <input type="submit" value="Reply" class="btn btn-default">
                </form>
            {% else %}
                <p>Only logged in users can write comments</p>
            {% endif %}
        </div>
        <hr/>
    </div>
{% endblock %}

{% block footer_js %}
    {{ block.super }}
    <script src="{% static 'js/replier.js' %}" type="text/javascript"></script>
{% endblock %}