{% extends 'base.html' %}

{% load staticfiles %}

{% block stylesheets %}
    {{ block.super }}
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.2.0/fullcalendar.min.css"/>
    <link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}"/>
{% endblock %}

{% block header_js %}
    {{ block.super }}
    <script type="text/javascript" src="https://code.jquery.com/jquery-migrate-3.0.0.min.js"
            integrity="sha256-JklDYODbg0X+8sPiKkcFURb5z7RvlNMIaE3RA2z97vw=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"
            integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
    <script src='//cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.2.0/fullcalendar.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.2.0/locale-all.js"></script>
    <script type="text/javascript" src="{% static 'js/custom.js' %}"></script>
    <script>
        $(document).ready(function() {

            const $overlay = $('<div id="overlay"></div>');
            $overlay.append($("#day_click_modal"));
            $("body").append($overlay);

            $overlay.click(function () {
                $(this).fadeOut();
            });

            function getWindowWidth(){
                return $(window).width();
            }

            const calendar = $('#calendar');

            calendar.fullCalendar({
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'agendaDay,agendaWeek,month'
                },
                weekNumbersWithinDays: true,
                eventLimit: true,
                navLinks: true,
                editable: true,
                dragOpacity: 1.0,
                windowResize: function(view) {
                    ww = getWindowWidth();
                    view = getView();
                    let currentView = calendar.fullCalendar('getView');

                    function getView(){
                        if (ww <= 800) {
                            return 'agendaDay'
                        } else if (ww > 800 && ww <= 1366) {
                            return 'agendaWeek';
                        } else if (ww > 1366) {
                            return 'month';
                        }
                    }

                    if(view != currentView){
                        $('#calendar').fullCalendar('changeView',view);
                    }
                    if(ww <= 768){
                        $('.fc-header-right .fc-button').hide();
                    }else{
                        $('.fc-header-right .fc-button').show();
                    }
                },

                // SEND THESE TO USER SETTINGS

                // First day of the week
                firstDay: 1,
                // Shown right-to-left
                isRTL: false,
                // Show weekends
                weekends: true,
                // Hide specific weekdays
                hiddenDays: [],
                // Dynamic amount of weeks in a month
                fixedWeekCount: false,
                // Show number of weeks
                weekNumbers: false,
                // Working hours
                businessHours: {
                    dow: [1,2,3,4,5],
                    start: '10:00',
                    end: '18:00'
                },
                // Daily event limit
                views: {
                    agenda: {
                        eventLimit: 3
                    },
                    month: {
                        eventLimit: 4
                    }
                },
                slotDuration: '00:30:00',
                allDaySlot: false,
                nowIndicator: true,
                locale: 'en',

                dayClick: function(date, jsEvent, view) {
                    $overlay.fadeIn();
                },
            });

            let eventSourcesFromAPI = [];

            $.getJSON('/api/calendar/list/', function (data) {
                    $.each(data, function ($key, $val) {
                        calendar.fullCalendar('addEventSource', $val['url'])
                    })
            });


        });
    </script>
{% endblock %}

{% block body_class %}has-loading-screen{% endblock %}
{% block body_attributes %}data-spy="scroll" data-target=".navigation"{% endblock %}

{% block pre_content %}
    <div class="page-wrapper" id="page-top">
{% endblock %}

{% block navigation %}
    <header id="page-header">

        <nav class="navigation nav-btn-only background-is-dark">
            <div class="container">
                <div class="wrapper">
                    <div class="left">
                        <!-- TODO: Move hardcoded styles -->
                        <a href="/" class="brand" style="font-size: 3rem;">aite</a>
                    </div>
                    <div class="right">
                        <ul class="nav navigation-links animate">
                            <li><a href="{% url 'dashboards:main' %}" class="scroll">Dashboard</a></li>
                            <li><a href="{% url 'posts:list' %}" class="scroll">Blog</a></li>

                            {% if not request.user.is_authenticated %}
                                <li><a href="{% url 'login' %}" class="scroll">Sign In</a></li>
                                <li><a href="{% url 'register' %}" class="scroll">Sign Up</a></li>
                            {% else %}
                                <li><a href="{% url 'logout' %}" class="scroll">Logout</a></li>
                            {% endif %}

                        </ul>
                        <div class="nav-btn">
                            <figure></figure>
                            <figure></figure>
                            <figure></figure>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>
{% endblock %}

{% block main %}
    <div id="page-content">
    <div class="container-fluid">
        <div class="col-sm-12 col-lg-10 col-lg-offset-1">
        <div class="card">
            <div class="calendar-container" id='calendar'></div>
        </div>
            </div>
    <br/><br/><br/>
    </div>
{% endblock %}

{% block footer %}
    <div class="note simple-footer">&copy; 2017 Totemish</div>
{% endblock %}

{% block post_content %}
    </div>
    </div>
{% endblock %}

{% block modals %}
    {% include 'modals/calendar/day_click_modal.html' %}
{% endblock %}

{% block footer_js %}
{% endblock %}
